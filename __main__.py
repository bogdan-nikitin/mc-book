import functoolsimport jsonimport pathlib# TODO: Tests# for debuggingINPUT = '''Now principles discovered off increasing how reasonably middletons men. Add seems out man met plate court sense. His joy she worth truth given. All year feet led view went sake. You agreeable breakfast his set perceived immediate. Stimulated man are projecting favourable middletons can cultivated. Tolerably earnestly middleton extremely distrusts she boy now not. Add and offered prepare how cordial two promise. Greatly who affixed suppose but enquire compact prepare all put. Added forth chief trees but rooms think may. Wicket do manner others seemed enable rather in. Excellent own discovery unfeeling sweetness questions the gentleman. Chapter shyness matters mr parlors if mention thought. Kindness to he horrible reserved ye. Effect twenty indeed beyond for not had county. The use him without greatly can private. Increasing it unpleasant no of contrasted no continuing. Nothing colonel my no removed in weather. It dissimilar in up devonshire inhabiting. He difficult contented we determine ourselves me am earnestly. Hour no find it park. Eat welcomed any husbands moderate. Led was misery played waited almost cousin living. Of intention contained is by middleton am. Principles fat stimulated uncommonly considered set especially prosperous. Sons at park mr meet as fact like. Too cultivated use solicitude frequently. Dashwood likewise up consider continue entrance ladyship oh. Wrong guest given purse power is no. Friendship to connection an am considered difficulty. Country met pursuit lasting moments why calling certain the. Middletons boisterous our way understood law. Among state cease how and sight since shall. Material did pleasure breeding our humanity she contempt had. So ye really mutual no cousin piqued summer result. However venture pursuit he am mr cordial. Forming musical am hearing studied be luckily. Ourselves for determine attending how led gentleman sincerity. Valley afford uneasy joy she thrown though bed set. In me forming general prudent on country carried. Behaved an or suppose justice. Seemed whence how son rather easily and change missed. Off apartments invitation are unpleasant solicitude fat motionless interested. Hardly suffer wisdom wishes valley as an. As friendship advantages resolution it alteration stimulated he or increasing. Inhabiting discretion the her dispatched decisively boisterous joy. So form were wish open is able of mile of. Waiting express if prevent it we an musical. Especially reasonable travelling she son. Resources resembled forfeited no to zealously. Has procured daughter how friendly followed repeated who surprise. Great asked oh under on voice downs. Law together prospect kindness securing six. Learning why get hastened smallest cheerful. Death there mirth way the noisy merit. Piqued shy spring nor six though mutual living ask extent. Replying of dashwood advanced ladyship smallest disposal or. Attempt offices own improve now see. Called person are around county talked her esteem. Those fully these way nay thing seems. Any delicate you how kindness horrible outlived servants. You high bed wish help call draw side. Girl quit if case mr sing as no have. At none neat am do over will. Agreeable promotion eagerness as we resources household to distrusts. Polite do object at passed it is. Small for ask shade water manor think men begin. Unpleasant nor diminution excellence apartments imprudence the met new. Draw part them he an to he roof only. Music leave say doors him. Tore bred form if sigh case as do. Staying he no looking if do opinion. Sentiments way understood end partiality and his. '''SECTION_SIGN = '§'CONFIG_FILE = 'config/config.json'# value in pixelsMAX_LINE_LEN = 114TRAILING_SPACE_MAX_LINE_LEN = 118MAX_LINES = 14def load_json(file_name):    with open(file_name) as file:        return json.load(file)class Config:    def __init__(self, config_file):        config = load_json(config_file)        path = pathlib.Path(config_file).parent        self.normal = {}        for file_name in config['normal']:            self.normal |= load_json(path.joinpath(file_name))        self.bold = {}        for file_name in config['bold']:            self.bold |= load_json(path.joinpath(file_name))class TextToBook:    def __init__(self, config):        self.config = config        self.is_bold = False    def get_char_len(self, char):        config = self.config.bold if self.is_bold else self.config.normal        return config[char] + 1    def get_word_len(self, word):        return sum(map(self.get_char_len, word))    @staticmethod    def __split_on_parts(text):        # parts are sections, newlines and spaces        parts = []        last_word = ''        for char in text:            if char == ' ' or char == '\n':                if last_word:                    parts += [last_word]                last_word = ''                parts += [char]            elif char == SECTION_SIGN:                if last_word:                    parts += [last_word]                last_word = char            else:                last_word += char        if last_word:            parts += [last_word]        return parts    @staticmethod    def __join_parts(parts):        return functools.reduce(lambda cur, part: cur + part, parts, '')    def __split_big_word_and_get_last_len(self, word):        parts = ['']        last_part_len = 0        for char in word:            char_len = self.get_char_len(char)            if last_part_len + char_len > MAX_LINE_LEN:                parts += ['']                last_part_len = 0            parts[-1] += char            last_part_len += char_len        return parts, last_part_len    def split_on_pages(self, text):        # TODO: Section signs support        pages = [[]]        line_len = 0        lines_count = 1        words = self.__split_on_parts(text)        for word in words:            if word == '\n':                # a newline can be inserted even if the lines count is maximum                pages[-1] += ['\n']                lines_count += 1                if lines_count > MAX_LINES:                    pages += [[]]                    lines_count = 1                line_len = 0            else:                word_len = self.get_word_len(word)                if word_len > MAX_LINE_LEN:                    word_parts, last_part_len = (                        self.__split_big_word_and_get_last_len(word)                    )                    for part in word_parts:                        lines_count += 1                        if lines_count > MAX_LINES:                            pages += [[]]                            lines_count = 1                        pages[-1] += [part]                    line_len = last_part_len                else:                    if word == ' ':                        max_line_len = TRAILING_SPACE_MAX_LINE_LEN                    else:                        max_line_len = MAX_LINE_LEN                    if line_len + word_len > max_line_len:                        line_len = word_len                        lines_count += 1                        if lines_count > MAX_LINES:                            pages += [[]]                            lines_count = 1                    else:                        line_len += word_len                    pages[-1] += [word]        return list(map(self.__join_parts, pages))    def generate_give(self, text, title, author):        """        Generates book give command with specified text, title and author        """        pages = self.split_on_pages(text)        pages_json = [json.dumps({'text': page}) for page in pages]        return (f'/give @p written_book{{pages:{pages_json},'                f'title:{repr(title)},author:{repr(author)}}}')# def generate_give_writable(text):#     pages = split_on_pages(text)#     pages = [json.dumps(page).strip('"') for page in pages]#     return f'/give @p writable_book{{pages:{json.dumps(pages)}}}'def main():    # split_on_pages('\n  a')    # split_on_pages('iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii  abc')    # split_on_pages('iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii   ')    # split_on_pages('''iiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiiii   a''')    # split_on_pages('abcd abcdefghijklmnopqrsthuvwxyz aboba')    #     split_on_pages('''a    # a    # a    # a    # a    # a    # a    # a    # a    # a    # a    # a    # a    # a    # b''')    text_to_book = TextToBook(Config(CONFIG_FILE))    print(text_to_book.generate_give('abc', '', ''))    print(text_to_book.generate_give(INPUT, '', ''))    # print(text_to_book.generate_give('§labc§r\nabc', '', ''))if __name__ == '__main__':    main()